# app.py リファクタリング計画 (2026-01-19)

## 目的
- ランチャー初期化フローの可読性と保守性の向上
- ツール起動/ウィンドウ管理の重複削減
- 入力/出力パス検証の責務整理

## 対象
- `iRIC_DataScope/app.py`
- 関連ファイル: `iRIC_DataScope/common/io_selector.py`, `iRIC_DataScope/common/iric_project.py`, 各 `*/launcher.py`

## 優先順位
### 高
1. **起動ボタン/ウィンドウ管理の共通化**（対応済み: 2026-01-19）
   - `open_*` / `_on_close_*` の重複を削減
   - ツール定義（ラベル/起動関数/ウィンドウ属性名）をデータ化
2. **バリデーション責務の分離**
   - `_validate` 内の入力判定とUI制御を分割
   - 入力種別判定を `common/iric_project.py` へ寄せることを検討

### 中
3. **遅延 import と例外処理の統一**（対応済み: 2026-01-19）
   - `try/except` が分散しているため、共通ヘルパーでログ収集
4. **`_resource_path` の安全性向上**（対応済み: 2026-01-19）
   - 直接 `relative_path` を合成してサブディレクトリ対応

### 低
5. **初期化フローの段階分割**（対応済み: 2026-01-19）
   - `__init__` の処理を `_initialize_ui()` などに整理
6. **UI 文言・URL の定数化**（対応済み: 2026-01-19）
   - 文言変更や翻訳対応を容易に

## 作業ステップ案
1. `open_*`/`_on_close_*` を調査し共通化方針を決定
2. ツール定義の構造（dataclass/dict）を導入
3. `_validate` を `is_valid_input_path` / `set_buttons_state` に分割
4. `_resource_path` の実装を見直し
5. 初期化フローを分割（ログ出力は維持）
6. 簡易テスト/動作確認（起動・ボタン有効化・ツール起動）

## 影響範囲とリスク
- 起動ボタン関連のリファクタでウィンドウ再利用の挙動が変わる可能性
- 入力検証の責務移動により例外処理の粒度が変わる可能性

## メモ
- スプラッシュ表示とログ初期化の順序は現状維持を前提
- `app.py` の UI 文字列は和文を維持
